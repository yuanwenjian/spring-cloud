!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core")):"function"==typeof define&&define.amd?define(["exports","@angular/core"],t):t(e.ng2Webstorage=e.ng2Webstorage||{},e.ng.core)}(this,function(e,t){"use strict";function r(e){return 0===e.indexOf(v+y)}function o(e,t){return function(t,r){n(e,c.local,t,r)}}function n(e,t,r,o){var n=e||o;Object.defineProperty(r,o,{get:function(){var e=d.genKey(n);return K.retrieve(t,e)},set:function(e){var r=d.genKey(n);this[r]=e,K.store(t,r,e)}})}function i(e){return function(t,r){n(e,c.local,t,r)}}function s(e){return function(t,r){n(e,c.session,t,r)}}function a(e){return new P(e)}function u(e){var t=void 0===e?{prefix:l,separator:g}:e,r=t.prefix,o=t.separator;console.warn("[ng2-webstorage:deprecation] The configure method is deprecated since the v1.5.0, consider to use forRoot instead"),d.setStorageKeyPrefix(r),d.setStorageKeySeparator(o)}var c;!function(e){e[e.local=0]="local",e[e.session=1]="session"}(c||(c={}));var f,l="ng2-webstorage",g="|",p=(f={},f[c.local]="local",f[c.session]="session",f),v=l,y=g,d=function(){function e(){}return e.isManagedKey=function(e){return 0===e.indexOf(v+y)},e.retrieveKeysFromStorage=function(e){return Object.keys(e).filter(r)},e.genKey=function(e){if("string"!=typeof e)throw Error("attempt to generate a storage key with a non string value");return""+v+y+e.toString().toLowerCase()},e.setStorageKeyPrefix=function(e){void 0===e&&(e=l),v=e},e.setStorageKeySeparator=function(e){void 0===e&&(e=g),y=e},e}(),h=function(){function e(){}return e.observe=function(e,r){var o=this.genObserverKey(e,r);return o in this.observers?this.observers[o]:this.observers[o]=new t.EventEmitter},e.emit=function(e,t,r){var o=this.genObserverKey(e,t);o in this.observers&&this.observers[o].emit(r)},e.genObserverKey=function(e,t){return e+"|"+t},e}();h.observers={};var S=function(){function e(){}return e.isSecuredField=function(t){return!!~e.securedFields.indexOf(t)},e.getStorage=function(t){return this.mockStorages[t]||(this.mockStorages[t]=e.generateStorage()),this.mockStorages[t]},e.generateStorage=function(){var t={};return Object.defineProperties(t,{setItem:{writable:!1,enumerable:!1,configurable:!1,value:function(t,r){e.isSecuredField(t)||(this[t]=r)}},getItem:{writable:!1,enumerable:!1,configurable:!1,value:function(t){return e.isSecuredField(t)?null:this[t]||null}},removeItem:{writable:!1,enumerable:!1,configurable:!1,value:function(t){e.isSecuredField(t)||delete this[t]}},length:{enumerable:!1,configurable:!1,get:function(){return Object.keys(this).length}}}),t},e}();S.securedFields=["setItem","getItem","removeItem","length"],S.mockStorages={};var b,m,w=(b={},b[c.local]={},b[c.session]={},b),O=(m={},m[c.local]=null,m[c.session]=null,m),K=function(){function e(){}return e.store=function(e,t,r){this.getStorage(e).setItem(t,JSON.stringify(r)),w[e][t]=r,h.emit(e,t,r)},e.retrieve=function(t,r){return w[t][r]?w[t][r]:w[t][r]=e.retrieveFromStorage(t,r)},e.retrieveFromStorage=function(e,t){var r=null;try{r=JSON.parse(this.getStorage(e).getItem(t))}catch(e){console.warn("invalid value for "+t)}return r},e.refresh=function(t,r){if(d.isManagedKey(r)){var o=e.retrieveFromStorage(t,r);null===o?(delete w[t][r],h.emit(t,r,null)):o!==w[t][r]&&(w[t][r]=o,h.emit(t,r,o))}},e.clearAll=function(e){var t=this.getStorage(e);d.retrieveKeysFromStorage(t).forEach(function(r){t.removeItem(r),delete w[e][r],h.emit(e,r,null)})},e.clear=function(e,t){this.getStorage(e).removeItem(t),delete w[e][t],h.emit(e,t,null)},e.getStorage=function(e){return this.isStorageAvailable(e)?this.getWStorage(e):S.getStorage(e)},e.getWStorage=function(e){var t;switch(e){case c.local:t=localStorage;break;case c.session:t=sessionStorage;break;default:throw Error("invalid storage type")}return t},e.isStorageAvailable=function(e){if("boolean"==typeof O[e])return O[e];var t,r=!0;try{t=this.getWStorage(e),"object"==typeof t?(t.setItem("test-storage","foobar"),t.removeItem("test-storage")):r=!1}catch(e){r=!1}return r||console.warn(p[e]+" storage unavailable, Ng2Webstorage will use a fallback strategy instead"),O[e]=r},e}(),_=function(){function e(e){void 0===e&&(e=null),this.sType=e,this.sType=e}return e.prototype.store=function(e,t){var r=d.genKey(e);K.store(this.sType,r,t)},e.prototype.retrieve=function(e){var t=d.genKey(e);return K.retrieve(this.sType,t)},e.prototype.clear=function(e){e?K.clear(this.sType,d.genKey(e)):K.clearAll(this.sType)},e.prototype.observe=function(e){var t=d.genKey(e);return h.observe(this.sType,t)},e}(),I=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),x=function(e){function t(){return e.call(this,c.local)||this}return I(t,e),t}(_);x.decorators=[{type:t.Injectable}],x.ctorParameters=function(){return[]};var j=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),F=function(e){function t(){return e.call(this,c.session)||this}return j(t,e),t}(_);F.decorators=[{type:t.Injectable}],F.ctorParameters=function(){return[]};var P=function(){function e(e){this.prefix=l,this.separator=g,e&&void 0!==e.prefix&&(this.prefix=e.prefix),e&&void 0!==e.separator&&(this.separator=e.separator)}return e}(),W=new t.OpaqueToken("WEBSTORAGE_CONFIG"),k=function(){function e(e,t){this.ngZone=e,t&&(d.setStorageKeyPrefix(t.prefix),d.setStorageKeySeparator(t.separator)),this.initStorageListener()}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:W,useValue:t},{provide:P,useFactory:a,deps:[W]}]}},e.prototype.initStorageListener=function(){var e=this;window&&window.addEventListener("storage",function(t){return e.ngZone.run(function(){var e=window.sessionStorage===t.storageArea?c.session:c.local;K.refresh(e,t.key)})})},e}();k.decorators=[{type:t.NgModule,args:[{declarations:[],providers:[F,x],imports:[]}]}],k.ctorParameters=function(){return[{type:t.NgZone},{type:P,decorators:[{type:t.Optional},{type:t.Inject,args:[P]}]}]},e.WEBSTORAGE_CONFIG=W,e.Ng2Webstorage=k,e.provideConfig=a,e.configure=u,e.WebstorageConfig=P,e.LocalStorage=i,e.SessionStorage=s,e.WebStorage=o,e.WebStorageDecorator=n,e.WebStorageService=_,e.LocalStorageService=x,e.SessionStorageService=F,Object.defineProperty(e,"__esModule",{value:!0})});